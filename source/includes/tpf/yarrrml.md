# RML Mapping

RML (RDF Mapping Language) is used by the Huwise platform to describe how a dataset should be represented in RDF.

This section explains how to create an RML mapping using [YARRRML](http://rml.io/yarrrml/).
YARRRML is a representation of RML using the YAML syntax.

## Running example

To illustrate how RML mapping works, [roman-emperors](https://documentation-resources.huwise.com/explore/dataset/roman-emperors/table/) dataset 
will be used as an example. It contains information about Roman emperors from 26 BC to 395 AD.

## RML rules

An RML mapping contains rules that define how facts of an RDF dataset are generated from an Huwise dataset.
In other words, it defines how each record is translated into triples (subject of a resource, predicate, object).

There are 3 types of rules that define:

* How IRIs of resources are generated
* What are the classes of the resources
* What are the others predicates and objects of the resource

## Start a YARRRML mapping

> An RML mapping that will describe 3 resources

```yaml
mappings:
  person:
  city:
  province:
```

YARRRML documents start with a `mappings` element.
Child elements of 'mappings' are called `mapping keys`. They identify all resources that will be generated.
Chosen keys have no influence on mapping as long as they are unique.

<aside>
In YARRRML documents, indentation is mandatory because it defines parent and child elements.
</aside>

## Define the IRI of a resource

> A rule defining how the IRI of the resources representing persons will be generated

```yaml
mappings:
  person:
    subject: https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/$(name)
```

> An example of 2 IRIs generated by the previous rule

```ttl
<https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/Augustus>
<https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/Nero>
```

The `subject` child element of a `mapping key` is used to define how the
IRI of the corresponding resource is generated.

Value of the subject key is a template.
A template is an IRI that can contain references to fields of the dataset.

A reference is `$(field_name)` where `field_name` is the name of a field of the dataset.
During the RDF transformation of a record, references are replaced by the value of the referenced field.

An IRI will be generated for each record of the dataset. If two generated IRIs are equal, resources
will be merged as one.

<aside>
Note that references are not mandatory in template.
Conversely, template can also contains only a reference to a field. It can be useful if the values of that field already contain valid IRIs.
</aside>

### Use Huwise platform as an IRI provider

> An example of dereferenceable Huwise IRI

```yaml
mappings:
  person:
    subject: https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/$(name)
```

Huwise provides an endpoint that makes the IRIs for resources dereferenceable according to the [Principles of Linked Data](https://en.wikipedia.org/wiki/Linked_data).

An IRI is said to be dereferenceable if it can be accessed to get more information about the resource it identifies. In other words, this endpoint enables to generate IRIs that uniquely describe a semantic resource on huwise, and leads to the corresponding, up-to-date data as long as resource IRIs start with:

`https://{DOMAIN_ID}.huwise.com/ld/resources/{DATASET_ID}/{RESOURCE_CLASS}/...`

Where `{DOMAIN_ID}` is the id of a domain containing the dataset, `{DATASET_ID}` is the id of the dataset on the domain `{DOMAIN_ID}` and `{RESOURCE_CLASS}` is a word representing the class of the resource.

## Define the classes of a resource

> An example of rules that associate 2 classes to a resource

```yaml
mappings:
  person:
    subject: https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/$(name)
    predicateobjects:
    - [a, 'http://schema.org/Person']
    - [a, 'http://xmlns.com/foaf/0.1/Person']
```
> An example of 2 triples generated by the previous rule

```ttl
<https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/Nero> a <http://schema.org/Person>,
      <http://xmlns.com/foaf/0.1/Person> ;
```

The `predicateobjects` element is used to define predicates and objects of a resource.
It is a child element of a `mapping key`.
Value of a `predicateobjects` child element is a list of arrays `[predicate, object]`.

To define the class of a resource,
`predicate` should be the IRI of the property `type` (`http://www.w3.org/1999/02/22-rdf-syntax-ns#type`) and
`object` should be the IRI of the class.

<aside>
`a` is a commonly used shortcut for `http://www.w3.org/1999/02/22-rdf-syntax-ns#type`.
</aside>

## Define other predicates and objects

> An example of a reference literal stating that the label identifying an emperor is the value in the field name

```yaml
mappings:
  person:
    subject: https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/$(name)
    predicateobjects:
    - ['http://www.w3.org/2000/01/rdf-schema#label', $(name)]
```

> An example of 2 triples generated by the previous rule

```ttl
<https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/Augustus>  <http://www.w3.org/2000/01/rdf-schema#label>  "Augustus".
<https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/Nero>  <http://www.w3.org/2000/01/rdf-schema#label>  "Nero".
```

> An example of a constant literal stating that the position of all person resources is emperor

```yaml
mappings:
  person:
    subject: https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/$(name)
    predicateobjects:
    - ['http://purl.org/vocab/bio/0.1/position', 'Emperor']
```

> An example of 2 triples generated by the previous rule

```ttl
<https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/Augustus>  <http://purl.org/vocab/bio/0.1/position>  "Emperor" .
<https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/Nero>  <http://purl.org/vocab/bio/0.1/position>  "Emperor" .
```

As seen in the previous section, value of a `predicateobjects` child element is
a list of arrays `[predicate, object]`.

To define a new predicate and object,
`predicate` should be the IRI of any property
of a vocabulary and `object` should be either:

* an IRI
* a template (see [Define the IRI of a resource](#define-the-iri-of-a-resource))
* a reference literal
* a constant literal

A literal is a value such as a string, a boolean, a number or a date.

A reference literal is a string value that contain references to fields of the dataset.

A reference is a string `$(field_name)` where `field_name` is the name of a field in the dataset.

During the RDF transformation of a record, if literal contains references, each reference is replaced by the value of the field referenced.

A constant literal is any literal that does not contain reference to fields of the dataset.

When literal is a constant, the same literal is generated for all resources.

<aside>
Note that reference literal can be a concatenation of references and constants such as "$(name) the great"
</aside>


## Define the datatype of a literal value

> An example of a reference literal with a defined datatype

```yaml
mappings:
  person:
    subject: https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/$(name)
    predicateobjects:
    - ['http://dbpedia.org/ontology/birthDate', $(birth), 'http://www.w3.org/2001/XMLSchema#dateTime']
```

> An example of triple generated by the previous rule

```ttl
<https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/Augustus>  <http://dbpedia.org/ontology/birthDate>  "0062-09-23T00:53:28+00:53"^^xsd:dateTime .
```

To define the datatype of a literal value, a datatype element is added to the array: `[predicate, object (literal), datatype]` where `datatype` is an IRI of a datatype in the [XML Schema Definition Language (XSD)](https://www.w3.org/TR/xmlschema-2/#built-in-datatypes).

## Define the language of a literal value

> An example of a constant literal with a defined language.

```yaml
mappings:
  person:
    subject: https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/$(name)
    predicateobjects:
    - ['http://purl.org/vocab/bio/0.1/position', 'Emperor', en~lang]
```

> An example of triple generated by the previous rule

```ttl
<https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/Augustus>  <http://purl.org/vocab/bio/0.1/position>  "Emperor"@en .
```

To define the datatype of a literal value, a language element is added to the array: `[predicate, object (literal), {language}~lang]` where `{language}` is an ISO 639-1 Language Code.

<aside>
Note that a datatype and a language cannot be defined at the same time.
</aside>

## Define a link to another resource

> An example of a rule stating the resource identified by the key 'city' is the birth place of the resource identified by the key 'person'

```yaml
mappings:
  person:
    subject: https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/$(name)
    predicateobjects:
    - ['http://dbpedia.org/ontology/birthPlace', city]
  city:
    subject: https://documentation-resources.huwise.com/ld/resources/roman-emperors/City/$(birth_cty)
    predicateobjects:
    - [a, 'http://schema.org/City']
```

> An example of 2 triples generated by the previous rule

```ttl
<https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/Augustus>  <http://dbpedia.org/ontology/birthPlace>  <https://documentation-resources.huwise.com/ld/resources/roman-emperors/City/Rome> .
<https://documentation-resources.huwise.com/ld/resources/roman-emperors/City/Rome>  a  <http://schema.org/City>  .
```

A link between two resources is an array `[predicate, object]` where `predicate` is the IRI of the property that links the resources and `object`
a key of another resource used in the `mappings` parent element.

## More information

> A complete example of RML mapping in YARRRML syntax

```yaml
mappings:
  person:
    subject: https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/$(name)
    predicateobjects:
    - [a, 'http://schema.org/Person']
    - [a, 'http://xmlns.com/foaf/0.1/Person']
    - ['http://www.w3.org/2000/01/rdf-schema#label', $(name)]
    - ['http://purl.org/vocab/bio/0.1/position', 'Emperor', en~lang]
    - ['http://dbpedia.org/ontology/deathDate', $(death), 'http://www.w3.org/2001/XMLSchema#dateTime']
    - ['http://dbpedia.org/ontology/birthDate', $(birth), 'http://www.w3.org/2001/XMLSchema#dateTime']
    - ['http://dbpedia.org/ontology/birthPlace', city]
    - ['http://dbpedia.org/ontology/birthPlace', province]
  city:
    subject: https://documentation-resources.huwise.com/ld/resources/roman-emperors/City/$(birth_cty)
    predicateobjects:
    - [a, 'http://schema.org/City']
    - [a, 'http://schema.org/Place']
    - [a, 'http://rdfs.co/juso/SpatialThing']
    - ['http://www.w3.org/2000/01/rdf-schema#label', $(birth_cty)]
  province:
    subject: https://documentation-resources.huwise.com/ld/resources/roman-emperors/Province/$(birth_prv)
    predicateobjects:
    - [a, 'http://dbpedia.org/ontology/Province']
    - [a, 'http://schema.org/Place']
    - [a, 'http://rdfs.co/juso/SpatialThing']
    - ['http://www.w3.org/2000/01/rdf-schema#label', $(birth_prv)]
```

> An example of a record generated in RDF using the previous mapping

```ttl
<https://documentation-resources.huwise.com/ld/resources/roman-emperors/Person/Augustus> a <http://schema.org/Person>,
        <http://xmlns.com/foaf/0.1/Person> ;
    rdfs:label "Augustus" ;
    ns1:birthDate "0062-09-23T00:53:28+00:53"^^xsd:dateTime ;
    ns1:birthPlace <https://documentation-resources.huwise.com/ld/resources/roman-emperors/City/Rome>,
        <https://documentation-resources.huwise.com/ld/resources/roman-emperors/Province/Italia> ;
    ns1:deathDate "0014-08-19T00:53:28+00:53"^^xsd:dateTime ;
    ns2:position "Emperor"@en .

<https://documentation-resources.huwise.com/ld/resources/roman-emperors/City/Rome> a <http://rdfs.co/juso/SpatialThing>,
        <http://schema.org/City>,
        <http://schema.org/Place> ;
    rdfs:label "Rome" .

<https://documentation-resources.huwise.com/ld/resources/roman-emperors/Province/Italia> a ns1:Province,
        <http://rdfs.co/juso/SpatialThing>,
        <http://schema.org/Place> ;
    rdfs:label "Italia" .
```

This section shows a complete example of an RML mapping for [roman-emperors](https://documentation-resources.huwise.com/explore/dataset/roman-emperors%40public/table) dataset.
It also provides more information about YARRRML and useful tools that facilitate the creation of an RML mapping.

### keys shortcuts

YARRRML allows multiple shortcut versions of keys to be used:

* subjects: subject, s
* predicateobjects: po

### Tools

Creating an RML mapping for a dataset is not an easy task. However, multiple tools can be really helpful in that process.

[The Linked Open Vocabulary](https://lov.linkeddata.es/dataset/lov/) is a great initiative. It proposes a search engine for vocabularies, properties and classes.

[Huwise Chatbot (beta)](https://chatbot.huwise.com) is a chatbot that helps users generate an RML mapping for an Huwise dataset.
