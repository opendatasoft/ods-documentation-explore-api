# OpenDataSoft RDF data

Data retrieved with the OpenDataSoft TPF API is in triple format described with RDF.
Data in such format can use ontologies (vocabularies) to define their meaning.

## Default Structure

By default, OpenDataSoft datasets are not enriched with ontologies. A direct mapping
of datasets to triple is used and follows 3 rules:

* A `record` is the `subject` of a triple
* A `field` is the `predicate` of a triple
* A `field value` is the `object` of a triple

Data resulting from this transformation describe dataset structure and contents but not its semantic.

## Edit Structure

OpenDataSoft datasets RDF structure can be described using [YARRRML](http://rml.io/yarrrml/) the YAML representation of RML (RDF Mapping Language).
Editing the RML mapping of a dataset modifies the structure and resources of the RDF dataset. Thus, it have an impact on RDF features such as TPF API, RDF exports, `Classes` filter, `Properties` filter, etc.
This section explains how to create a YARRRML mapping for OpenDataSoft dataset.

### Running example

To illustrate how RML mapping works, [roman-emperors](https://data.opendatasoft.com/explore/dataset/roman-emperors%40public/table) dataset will be used as an example. It contains informations about roman emperors from 26 BC to 395 AD.

### RML rules

A RML mapping contains rules that define how resources of a RDF dataset are generated from an OpenDataSoft dataset.
In other words, it defines how each record is translated into triples.

There is 3 type of rules that define:
* How the IRI of resources are generated
* What are the classes of the resources
* What are the predicates and objects of the resource

### Start a YARRRML mapping

> A RML mapping that will describe 3 resources

```yaml
mappings:
  person:
  city:
  province:
```

YARRRML documents start with a `mappings` element.
Child elements of 'mappings' identify distinct resource that will be generated.
Chosen keys have no influence on mapping as long as they are unique.

<aside>
In YARRRML documents, indentation defines parent and child elements.
</aside>

### How to define IRI of resources

> A rule defining how the IRI of the resources representing persons will be generated. An IRI will be generated for each Emperors that have a distinct name.

```yaml
mappings:
  person:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/$(name)
```

> An example of 2 IRIs generated by the previous rule.

```ttl
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Augustus>
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Nero>
```

the `subject` child element of a resource element is used to define how
IRI of the corresponding resource is generated.

Value of the subject key is a template. A template is an IRI that can contain references to fields of the dataset.
A reference is `$(field_name)` where `field_name` is the name of a field of the dataset.

<aside>
Note that reference are not mandatory in template. Template can also contains only a reference to a field if values of that field are IRIs.
</aside>

OpenDataSoft provides an endpoint that makes the IRIs for resources dereferencable according to the [Principles of Linked Data](https://en.wikipedia.org/wiki/Linked_data).

An IRI is said to be dereferencable if it can be accessed to get more information about the resource it identifies. In other words, this endpoint enables to generate IRIs that uniquely describe a semantic resource on OpenDataSoft, and leads to the corresponding, up-to-date data as long as resource IRIs start with:

`https://{DOMAIN_ID}.opendatasoft.com/ld/resources/{DATASET_ID}/{RESOURCE_CLASS}/...``

Where `{DOMAIN_ID}` is the id of a domain containing the dataset, `{DATASET_ID}` is the id of the dataset on the domain `{DOMAIN_ID}` and `{RESOURCE_CLASS}` is a word representing the class of the resource.

### How to define the class of a resource

> An example of predicateobjects rules that associate 2 classes for a resource

```yaml
mappings:
  person:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/$(name)
    predicateobjects:
    - [a, 'http://schema.org/Person']
    - [a, 'http://xmlns.com/foaf/0.1/Person']
```

# OLD DOC





> An example of complete RML mapping in YARRRML syntax

```yaml
mappings:
  person:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/$(name)
    predicateobjects:
    - [a, 'http://schema.org/Person']
    - [a, 'http://xmlns.com/foaf/0.1/Person']
    - ['http://www.w3.org/2000/01/rdf-schema#label', $(name)]
    - ['http://purl.org/vocab/bio/0.1/position', 'Emperor', en~lang]
    - ['http://dbpedia.org/ontology/deathDate', $(death), 'http://www.w3.org/2001/XMLSchema#datetime']
    - ['http://dbpedia.org/ontology/birthDate', $(birth), 'http://www.w3.org/2001/XMLSchema#datetime']
    - ['http://dbpedia.org/ontology/birthPlace', city]
    - ['http://dbpedia.org/ontology/birthPlace', province]
  city:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/City/$(birth_cty)
    predicateobjects:
    - [a, 'http://schema.org/City']
    - [a, 'http://schema.org/Place']
    - [a, 'http://rdfs.co/juso/SpatialThing']
    - ['http://www.w3.org/2000/01/rdf-schema#label', $(birth_cty)]
  province:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Province/$(birth_prv)
    predicateobjects:
    - [a, 'http://dbpedia.org/ontology/Province']
    - [a, 'http://schema.org/Place']
    - [a, 'http://rdfs.co/juso/SpatialThing']
    - ['http://www.w3.org/2000/01/rdf-schema#label', $(birth_prv)]
```

## Classes and Properties filters

The `Classes` and `Properties` filters contain all the classes and properties used in the RML mapping of the dataset.
They can be used to search datasets representing a specific concept such as Persons, Cars or properties such as age or fuel consumption.
