# OpenDataSoft RDF data

Data retrieved with the OpenDataSoft TPF API is in triple format described with RDF.
Data in such format can use ontologies (vocabularies) to define their meaning.

## Default Structure

By default, OpenDataSoft datasets are not enriched with ontologies. A direct mapping
of datasets to triple is used and follows 3 rules:

* A `record` is the `subject` of a triple
* A `field` is the `predicate` of a triple
* A `field value` is the `object` of a triple

Data resulting from this transformation describe dataset structure and contents but not its semantic.

## Edit Structure

OpenDataSoft datasets RDF structure can be described using [YARRRML](http://rml.io/yarrrml/) the YAML representation of RML (RDF Mapping Language).
Editing the RML mapping of a dataset modifies the structure and resources of the RDF dataset. Thus, it have an impact on RDF features such as TPF API, RDF exports, `Classes` filter, `Properties` filter, etc.
This section explains how to create a YARRRML mapping for OpenDataSoft dataset.

### Running example

To illustrate how RML mapping works, [roman-emperors](https://data.opendatasoft.com/explore/dataset/roman-emperors%40public/table) dataset will be used as an example. It contains informations about roman emperors from 26 BC to 395 AD.

### RML rules

A RML mapping contains rules that define how resources of a RDF dataset are generated from an OpenDataSoft dataset.
In other words, it defines how each record is translated into triples.

There is 3 type of rules that define:

* How the IRI of resources are generated
* What are the classes of the resources
* What are the predicates and objects of the resource

### Start a YARRRML mapping

> A RML mapping that will describe 3 resources

```yaml
mappings:
  person:
  city:
  province:
```

YARRRML documents start with a `mappings` element.
Child elements of 'mappings' identify distinct resource that will be generated.
Chosen keys have no influence on mapping as long as they are unique.

<aside>
In YARRRML documents, indentation defines parent and child elements.
</aside>

### Define the IRI of a resource

> A rule defining how the IRI of the resources representing persons will be generated.

```yaml
mappings:
  person:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/$(name)
```

> An example of 2 IRIs generated by the previous rule

```ttl
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Augustus>
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Nero>
```

the `subject` child element of a resource element is used to define how
IRI of the corresponding resource is generated.

Value of the subject key is a template. A template is an IRI that can contain references to fields of the dataset.
A reference is `$(field_name)` where `field_name` is the name of a field of the dataset.
An IRI will be generated for each record of the dataset. If two generated IRIs are equivalents, resources
will be the same.

<aside>
Note that reference are not mandatory in template. Template can also contains only a reference to a field if values of that field are IRIs.
</aside>

OpenDataSoft provides an endpoint that makes the IRIs for resources dereferencable according to the [Principles of Linked Data](https://en.wikipedia.org/wiki/Linked_data).

An IRI is said to be dereferencable if it can be accessed to get more information about the resource it identifies. In other words, this endpoint enables to generate IRIs that uniquely describe a semantic resource on OpenDataSoft, and leads to the corresponding, up-to-date data as long as resource IRIs start with:

`https://{DOMAIN_ID}.opendatasoft.com/ld/resources/{DATASET_ID}/{RESOURCE_CLASS}/...``

Where `{DOMAIN_ID}` is the id of a domain containing the dataset, `{DATASET_ID}` is the id of the dataset on the domain `{DOMAIN_ID}` and `{RESOURCE_CLASS}` is a word representing the class of the resource.

### Define the classes of a resource

> An example of predicateobjects rules that associate 2 classes to a resource

```yaml
mappings:
  person:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/$(name)
    predicateobjects:
    - [a, 'http://schema.org/Person']
    - [a, 'http://xmlns.com/foaf/0.1/Person']
```
> An example of 2 triples generated by the previous rule

```ttl
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Nero> a <http://schema.org/Person>,
      <http://xmlns.com/foaf/0.1/Person> ;
```

The `predicateobjects` child element of a resource element is used to define predicates and objects that will be generated for the corresponding resource.

Value of a `predicateobjects` child element is a list of arrays `[predicate, object]`. To define the class of the resource, `predicate` should be the IRI of the property `type` of RDF vocabulary (`http://www.w3.org/1999/02/22-rdf-syntax-ns#type`) and `object` should be the IRI of the class.

<aside>
Note that `a` is a commonly used shortcut for `http://www.w3.org/1999/02/22-rdf-syntax-ns#type`.
</aside>

### Define other predicates and objects

> An example of a reference literal stating that the label identifying an emperor is the value in the field name

```yaml
mappings:
  person:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/$(name)
    predicateobjects:
    - ['http://www.w3.org/2000/01/rdf-schema#label', $(name)]
```

> An example of 2 triples generated by the previous rule

```ttl
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Augustus>  <http://www.w3.org/2000/01/rdf-schema#label>  "Augustus".
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Nero>  <http://www.w3.org/2000/01/rdf-schema#label>  "Nero".
```

As seen in the previous section, value of a `predicateobjects` child element is
a list of arrays `[predicate, object]` where `predicate` is an IRI of any property
of a vocabulary and `object` is either:

* an IRI
* a template (see [Define the IRI of a resource](#define-the-iri-of-a-resource))
* a reference literal
* a constant literal

A literal is a value such as a string, a boolean, a number or a date.

A reference literal is a string value that contain references to fields of the dataset.
A reference is `$(field_name)` where `field_name` is the name of a field of the dataset.
A distinct literal will be generated for each record of the dataset.

> An example of a constant literal stating that the position of all person resources is emperor.

```yaml
mappings:
  person:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/$(name)
    predicateobjects:
    - ['http://purl.org/vocab/bio/0.1/position', 'Emperor']
```

> An example of 2 triples generated by the previous rule

```ttl
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Augustus>  <http://purl.org/vocab/bio/0.1/position>  "Emperor" .
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Nero>  <http://purl.org/vocab/bio/0.1/position>  "Emperor" .
```

A constant literal is any literal that does not contains reference to fields of the dataset.
In this case, the same literal will be generated for each resources.

<aside>
Note that reference literal can be a concatenation of references and constants such as "$(name) the great"
</aside>


### Define the datatype of a literal value

> An example of a reference literal with a defined datatype.

```yaml
mappings:
  person:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/$(name)
    predicateobjects:
    - ['http://dbpedia.org/ontology/birthDate', $(birth), 'http://www.w3.org/2001/XMLSchema#datetime']
```

> An example of triple generated by the previous rule

```ttl
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Augustus>  <http://dbpedia.org/ontology/birthDate>  "0062-09-23T00:53:28+00:53"^^xsd:datetime .
```

To define the datatype of a literal value, a datatype element is added to the array: `[predicate, object (literal), datatype]` where `datatype` is an IRI of a datatype in the [XML Schema Definition Language (XSD)](https://www.w3.org/TR/xmlschema-2/#built-in-datatypes).

### Define the language of a literal value

> An example of a constant literal with a defined language.

```yaml
mappings:
  person:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/$(name)
    predicateobjects:
    - ['http://purl.org/vocab/bio/0.1/position', 'Emperor', en~lang]
```

> An example of triple generated by the previous rule

```ttl
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Augustus>  <http://purl.org/vocab/bio/0.1/position>  "Emperor"@en .
```

To define the datatype of a literal value, a language element is added to the array: `[predicate, object (literal), {language}~lang]` where `{language}` is replaced by an ISO 639-1 Language Codes.

<aside>
Note that a datatype and a language cannot be defined at the same time.
</aside>

### Define a link to another resource

> An example of a rule stating the resource identified by the key 'city' is the birth place of the resource identified by the key 'person'

```yaml
mappings:
  person:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/$(name)
    predicateobjects:
    - ['http://dbpedia.org/ontology/birthPlace', city]
  city:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/City/$(birth_cty)
    predicateobjects:
    - [a, 'http://schema.org/City']
```

> An example of 2 triples generated by the previous rule

```ttl
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Augustus>  <http://dbpedia.org/ontology/birthPlace>  <https://data.opendatasoft.com/ld/resources/roman-emperors@public/City/Rome> .
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/City/Rome>  a  <http://schema.org/City>  .
```

A link between two resources is an array `[predicate, object]` where `predicate` is the IRI of the property that links the resources and `object`
a key of another resource used in the `mappings` parent element.


### A complete YARRRML mapping

> A complete example of RML mapping in YARRRML syntax

```yaml
mappings:
  person:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/$(name)
    predicateobjects:
    - [a, 'http://schema.org/Person']
    - [a, 'http://xmlns.com/foaf/0.1/Person']
    - ['http://www.w3.org/2000/01/rdf-schema#label', $(name)]
    - ['http://purl.org/vocab/bio/0.1/position', 'Emperor', en~lang]
    - ['http://dbpedia.org/ontology/deathDate', $(death), 'http://www.w3.org/2001/XMLSchema#datetime']
    - ['http://dbpedia.org/ontology/birthDate', $(birth), 'http://www.w3.org/2001/XMLSchema#datetime']
    - ['http://dbpedia.org/ontology/birthPlace', city]
    - ['http://dbpedia.org/ontology/birthPlace', province]
  city:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/City/$(birth_cty)
    predicateobjects:
    - [a, 'http://schema.org/City']
    - [a, 'http://schema.org/Place']
    - [a, 'http://rdfs.co/juso/SpatialThing']
    - ['http://www.w3.org/2000/01/rdf-schema#label', $(birth_cty)]
  province:
    subject: https://data.opendatasoft.com/ld/resources/roman-emperors@public/Province/$(birth_prv)
    predicateobjects:
    - [a, 'http://dbpedia.org/ontology/Province']
    - [a, 'http://schema.org/Place']
    - [a, 'http://rdfs.co/juso/SpatialThing']
    - ['http://www.w3.org/2000/01/rdf-schema#label', $(birth_prv)]
```

> An example of a record generated in RDF using the previous mapping

```ttl
<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Person/Augustus> a <http://schema.org/Person>,
        <http://xmlns.com/foaf/0.1/Person> ;
    rdfs:label "Augustus" ;
    ns1:birthDate "0062-09-23T00:53:28+00:53"^^xsd:datetime ;
    ns1:birthPlace <https://data.opendatasoft.com/ld/resources/roman-emperors@public/City/Rome>,
        <https://data.opendatasoft.com/ld/resources/roman-emperors@public/Province/Italia> ;
    ns1:deathDate "0014-08-19T00:53:28+00:53"^^xsd:datetime ;
    ns2:position "Emperor"@en .

<https://data.opendatasoft.com/ld/resources/roman-emperors@public/City/Rome> a <http://rdfs.co/juso/SpatialThing>,
        <http://schema.org/City>,
        <http://schema.org/Place> ;
    rdfs:label "Rome" .

<https://data.opendatasoft.com/ld/resources/roman-emperors@public/Province/Italia> a ns1:Province,
        <http://rdfs.co/juso/SpatialThing>,
        <http://schema.org/Place> ;
    rdfs:label "Italia" .
```


## Classes and Properties filters

The `Classes` and `Properties` filters contain all the classes and properties used in the RML mapping of the dataset.
They can be used to search datasets representing a specific concept such as Persons, Cars or properties such as age or fuel consumption.
